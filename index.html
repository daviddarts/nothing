<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NOTHING</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet" />

  <style>
    :root {
      /* Faster, pulsing timings (ms) */
      --fade-in-ms: 900;              /* time to fade in */
      --fade-out-ms: 700;             /* time to fade out */
      --gap-ms: 0;                    /* no gaps at all */

      /* First/last: faster overall; “nothing” still lingers a touch */
      --first-fade-out-mult: 1.1;     /* was 2; keep only slightly slower */
      --thanks-fade-out-mult: 1.1;    /* symmetric with first line */
      --special-nothing-extra-hold-ms: 650; /* shorter linger for “nothing” on first/last */

      /* Middle lines: quick fade-out feel */
      --middle-fade-out-mult: 0.7;

      /* Promos at the end (kept short so pace stays up) */
      --promo-link-hold-ms: 2000;     /* links linger, but not long */
      --october-hold-ms: 500;         /* quick blip */
      --promo-fade-out-mult: 0.6;

      /* link styling */
      --link-color: #6b7280;
      --link-hover: #111827;
    }

    /* Non-scrollable, no rubber-band (iPhone-safe) */
    html, body {
      height: 100%;
      margin: 0;
      background: white;
      color: black;
      overflow: hidden;
      overscroll-behavior: none;
    }

    body {
      position: fixed;
      inset: 0;
      height: 100dvh;
      display: grid;
      place-items: center;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      touch-action: none;          /* own the gesture */
      user-select: none;
      -webkit-user-select: none;
    }

    /* Stage holds two stacked lines for crossfade */
    #stage {
      position: relative;
      width: 100%;
      height: 100%;
      display: grid;
      place-items: center;
    }

    .line {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      opacity: 0; /* animated via WAAPI */
      pointer-events: none; /* enabled only on the top line when needed */
    }

    .content {
      font-family: "Roboto", "Helvetica Neue", Arial, sans-serif;
      font-weight: 900;
      font-size: clamp(28px, 8vw, 64px);
      line-height: 1.15;
      text-align: center;
      max-width: min(90vw, 1200px);
      color: #000;
    }

    /* Token spans for partial fade */
    .token { transition-property: opacity; }
    .rest  { opacity: 1; }
    .nothing { opacity: 1; }

    /* Links: gray, no underline */
    .content a {
      color: var(--link-color);
      text-decoration: none;
      cursor: pointer;
      pointer-events: auto; /* allow link clicks */
    }
    .content a:hover,
    .content a:focus-visible {
      color: var(--link-hover);
    }
    .content a:focus-visible {
      outline: 2px solid currentColor;
      outline-offset: 4px;
    }

    @media (prefers-reduced-motion: reduce) {
      .line, .token { transition: none !important; opacity: 1 !important; }
    }
  </style>
</head>
<body>
  <div id="stage" aria-live="polite">
    <div class="line" id="lineA"><div class="content"></div></div>
    <div class="line" id="lineB"><div class="content"></div></div>
  </div>

  <script>
    /* ------------------ Content ------------------ */
    const items = [
      `Nothing to see here.`,
      `Less than nothing.`,
      `A whole lotta nothing.`,
      `A big fat nothingburger.`,
      `Nothing new under the sun.`,
      `Nothing but dead air.`,
      `Nothing but net.`,
      `This is nothing new.`,
      `Nothing special.`,
      `Nothing to write home about.`,
      `I’ve got nothing to do.`,
      `Nothing to wear.`,
      `Nothing fancy.`,
      `Nothing in particular.`,
      `Nothing much.`,
      `Practically nothing.`,
      `I won’t settle for nothing.`,
      `Something out of nothing?`,
      `Leave nothing to chance.`,
      `Nothing to lose.`,
      `Nothing to complain about.`,
      `Think nothing of it.`,
      `Next to nothing.`,
      `Close to nothing.`,
      `Better than nothing.`,
      `Nothing ventured, nothing gained.`,
      `Leave nothing on the table.`,
      `Accept nothing less.`,
      `There’s nothing to it.`,
      `Nothing compares.`,
      `Sweet nothings.`,
      `Leave nothing to the imagination.`,
      `Nothing short of a miracle.`,
      `Nothing to sneeze at.`,
      `Nothing else matters.`,
      `Nothing but the best.`,
      `Nothing can stop us.`,
      `Nothing can come between us.`,
      `Nothing but blue skies.`,
      `There’s nothing like it.`,
      `Nothing can go wrong.`,
      `All or nothing.`,
      `I will stop at nothing.`,
      `Double or nothing.`,
      `Nothing worth having comes easy.`,
      `Much ado about nothing.`,
      `Nothing of the sort.`,
      `Nothing to worry about.`,
      `Think nothing of it.`,
      `Nothing will come of it.`,
      `Make nothing of it.`,
      `It signifies nothing.`,
      `You have nothing to fear.`,
      `There’s nothing going on.`,
      `Have you nothing to say?`,
      `Nothing could be further from the truth.`,
      `I’ve got nothing to gain.`,
      `Nothing to add.`,
      `Nothing to prove.`,
      `Nothing to declare.`,
      `Nothing to hide.`,
      `Nothing to report.`,
      `I’ve done nothing to regret.`,
      `Time to say nothing.`,
      `Nothing but excuses.`,
      `You’ve got nothing on me.`,
      `Nothing but the truth.`,
      `Leave nothing out.`,
      `Nothing ever goes as planned.`,
      `Nothing good happens after 2AM.`,
      `Nothing but trouble.`,
      `Nothing short of a disaster.`,
      `There’s nothing between us.`,
      `Is nothing sacred?`,
      `Nothing but smoke and mirrors.`,
      `Nothing but empty promises.`,
      `This counts for nothing.`,
      `You can’t expect something for nothing.`,
      `Nothing is free.`,
      `Nothing lasts forever.`,
      `It’s nothing personal.`,
      `I’ve got nothing in the tank.`,
      `Nothing but skin and bones.`,
      `Nothing but the shirt on my back.`,
      `Nothing to show for it.`,
      `You are good for nothing.`,
      `This was all for nothing.`,
      `It all amounts to nothing.`,
      `It’s worth nothing.`,
      `I’ve got nothing.`,
      `You are nothing.`,
      `Thanks for nothing.`,
      // Promos
      { text: 'AiOP 2025 NOTHING', href: 'https://nothing.artinoddplaces.org/' },
      { text: 'October 18-19' },
      { text: 'DAVIDDARTS.COM', href: 'https://daviddarts.com' },
    ];

    /* ------------------ Setup ------------------ */
    const stage = document.getElementById('stage');
    const lineA = document.getElementById('lineA');
    const lineB = document.getElementById('lineB');
    const buffers = [lineA, lineB];

    const css = getComputedStyle(document.documentElement);
    const fadeInMs  = parseInt(css.getPropertyValue('--fade-in-ms'))  || 900;
    const fadeOutMs = parseInt(css.getPropertyValue('--fade-out-ms')) || 700;
    const middleFadeOutMult = parseFloat(css.getPropertyValue('--middle-fade-out-mult')) || 0.7;
    const firstFadeOutMult  = parseFloat(css.getPropertyValue('--first-fade-out-mult'))  || 1.1;
    const thanksFadeOutMult = parseFloat(css.getPropertyValue('--thanks-fade-out-mult')) || 1.1;

    const promoLinkHold = parseInt(css.getPropertyValue('--promo-link-hold-ms')) || 2000;
    const octoberHold   = parseInt(css.getPropertyValue('--october-hold-ms'))    || 500;
    const promoFadeOutMult = parseFloat(css.getPropertyValue('--promo-fade-out-mult')) || 0.6;

    const specialNothingExtraHold =
      parseInt(css.getPropertyValue('--special-nothing-extra-hold-ms')) || 650;

    const NOTHING_SPLIT = /(nothing)s?/gi;
    const NOTHING_TEST  = /nothing/i;

    const isObj = (item) => typeof item === 'object' && item !== null;
    const isLinkItem = (item) => isObj(item) && 'href' in item;

    function renderItemToHTML(item) {
      if (isLinkItem(item)) {
        return `<div class="content"><a href="${item.href}" target="_blank" rel="noopener noreferrer">${item.text}</a></div>`;
      }
      const text = isObj(item) ? item.text : String(item);
      const parts = text.split(NOTHING_SPLIT);
      let html = '<div class="content">';
      for (let idx = 0; idx < parts.length; idx++) {
        const part = parts[idx];
        if (!part) continue;
        if (/^nothing$/i.test(part)) {
          html += `<span class="token nothing">${part}</span>`;
        } else if (/^nothings$/i.test(part)) {
          html += `<span class="token nothing">nothing</span><span class="token rest">s</span>`;
        } else {
          html += `<span class="token rest">${part}</span>`;
        }
      }
      html += '</div>';
      return html;
    }

    function lineHasNothing(item) {
      if (isLinkItem(item)) return false;
      const text = isObj(item) ? item.text : String(item);
      return NOTHING_TEST.test(text);
    }

    function animateOnce(el, keyframes, options) {
      const anim = el.animate(keyframes, options);
      return { anim, done: new Promise(res => anim.addEventListener('finish', res, { once: true })) };
    }

    /* ------------------ Crossfade engine ------------------ */
    let i = 0;
    let active = 0;            // which buffer will be used for the next fade-in
    let autoplay = true;
    let timers = new Set();
    let resumeTimer = null;
    let resumeAdvanceNext = false;

    function schedule(fn, ms) {
      const id = setTimeout(() => { timers.delete(id); fn(); }, ms);
      timers.add(id);
      return id;
    }
    function clearTimers() {
      timers.forEach(id => clearTimeout(id));
      timers.clear();
    }
    function cancelAllAnimations() {
      try {
        (document.getAnimations?.() || []).forEach(a => { try { a.cancel(); } catch {} });
      } catch {}
    }

    function holdForItem(item) {
      if (isLinkItem(item)) return promoLinkHold;
      if (isObj(item) && item.text === 'October 18-19') return octoberHold;
      return 0; // POEM LINES: no hold at all
    }

    function fadeOutDuration(idx, item) {
      const isFirst = idx === 0;
      const isThanks = (typeof item === 'string' && item === 'Thanks for nothing.');
      const isPromo = isObj(item);
      if (isPromo) return Math.round(fadeOutMs * promoFadeOutMult);
      if (isFirst)  return Math.round(fadeOutMs * firstFadeOutMult);
      if (isThanks) return Math.round(fadeOutMs * thanksFadeOutMult);
      return Math.round(fadeOutMs * middleFadeOutMult);
    }

    function pauseAndScheduleResume({ advanceOnResume = true } = {}) {
      autoplay = false;
      resumeAdvanceNext = advanceOnResume;
      if (resumeTimer) clearTimeout(resumeTimer);
      resumeTimer = setTimeout(() => {
        autoplay = true;
        if (resumeAdvanceNext) {
          i = (i + 1) % items.length; // start from next line after the one user last saw
          resumeAdvanceNext = false;
        }
        // restart crossfade loop from current index
        startLine(i);
      }, 4000); // matches --resume-idle-ms logic from earlier versions
    }

    function startLine(index) {
      if (!autoplay) return;

      const item = items[index];
      const nextBuf = buffers[active];
      const otherBuf = buffers[1 - active];

      // Render and bring next buffer on top for interaction
      nextBuf.innerHTML = renderItemToHTML(item);
      nextBuf.style.pointerEvents = 'auto';
      otherBuf.style.pointerEvents = 'none';

      // Reset opacity instantly before animating
      nextBuf.style.opacity = '0';

      // Fade-in
      animateOnce(nextBuf, [{ opacity: 0 }, { opacity: 1 }], {
        duration: fadeInMs,
        easing: 'cubic-bezier(0.2, 0, 0, 1)',
        fill: 'forwards'
      });

      // As soon as this line becomes fully visible, immediately:
      // 1) begin its fade-out (tokenized for "nothing" lines)
      // 2) start the NEXT line's fade-in on the other buffer (crossfade)
      const hasNothing = lineHasNothing(item);
      const isFirst = index === 0;
      const isThanks = (typeof item === 'string' && item === 'Thanks for nothing.');
      const thisFadeOut = fadeOutDuration(index, item);
      const holdMs = holdForItem(item); // promos only

      // Schedule the next line's start exactly when this hits full opacity + any promo hold
      schedule(() => {
        if (!autoplay) return;
        const nextIndex = (index + 1) % items.length;
        active = 1 - active; // swap buffer for the next fade-in
        startLine(nextIndex);
      }, fadeInMs + holdMs);

      // Schedule this line's fade-out behavior (starts immediately after fade-in)
      schedule(() => {
        if (hasNothing) {
          // Set transitions on tokens
          const tokens = nextBuf.querySelectorAll('.token');
          tokens.forEach(t => {
            t.style.transitionProperty = 'opacity';
            t.style.transitionTimingFunction = 'ease-in-out';
            t.style.transitionDuration = `${thisFadeOut}ms`;
            t.style.opacity = '1';
          });

          // 1) Fade non-"nothing" immediately
          nextBuf.querySelectorAll('.rest').forEach(t => t.style.opacity = '0');

          // 2) Short linger for the word "nothing" on first/last only
          const extraPause = (isFirst || isThanks) ? specialNothingExtraHold : 0;

          schedule(() => {
            nextBuf.querySelectorAll('.nothing').forEach(t => t.style.opacity = '0');
          }, extraPause);

        } else {
          // Whole line fades out
          animateOnce(nextBuf, [{ opacity: 1 }, { opacity: 0 }], {
            duration: thisFadeOut,
            easing: 'ease-in-out',
            fill: 'forwards'
          });
        }
      }, fadeInMs); // start fade-out immediately when fully visible
    }

    /* ------------------ Manual navigation (kept) ------------------ */
    function clearAll() { clearTimers(); cancelAllAnimations(); }

    function jumpBy(step) {
      // Pause autoplay, schedule resume (and advance to next when resuming)
      pauseAndScheduleResume({ advanceOnResume: true });

      // Cancel current activity
      clearAll();

      // Show requested line now (single render; no scheduling of the next)
      i = (i + step + items.length) % items.length;
      const buf = buffers[active];
      const other = buffers[1 - active];
      buf.innerHTML = renderItemToHTML(items[i]);
      buf.style.pointerEvents = 'auto';
      other.style.pointerEvents = 'none';
      buf.style.opacity = '0';
      animateOnce(buf, [{ opacity: 0 }, { opacity: 1 }], {
        duration: fadeInMs,
        easing: 'cubic-bezier(0.2, 0, 0, 1)',
        fill: 'forwards'
      });
      // Begin its fade-out immediately (keeps the pulsing feel during manual browsing)
      const hasNothing = lineHasNothing(items[i]);
      const thisFadeOut = fadeOutDuration(i, items[i]);
      schedule(() => {
        if (hasNothing) {
          const tokens = buf.querySelectorAll('.token');
          tokens.forEach(t => {
            t.style.transitionProperty = 'opacity';
            t.style.transitionTimingFunction = 'ease-in-out';
            t.style.transitionDuration = `${thisFadeOut}ms`;
            t.style.opacity = '1';
          });
          buf.querySelectorAll('.rest').forEach(t => t.style.opacity = '0');
          schedule(() => {
            buf.querySelectorAll('.nothing').forEach(t => t.style.opacity = '0');
          }, (i === 0 || (typeof items[i] === 'string' && items[i] === 'Thanks for nothing.')) ? specialNothingExtraHold : 0);
        } else {
          animateOnce(buf, [{ opacity: 1 }, { opacity: 0 }], {
            duration: thisFadeOut,
            easing: 'ease-in-out',
            fill: 'forwards'
          });
        }
      }, fadeInMs);
    }

    // Swipe (horizontal) + click
    let tracking = null;
    const AXIS_LOCK_RATIO = 1.2;
    const MIN_VELOCITY = 0.35; // px/ms
    function now() { return performance.now(); }

    function beginTrack(e) {
      if (tracking) return;
      tracking = {
        id: e.pointerId,
        startX: e.clientX,
        startY: e.clientY,
        lastX: e.clientX,
        lastY: e.clientY,
        startT: now()
      };
    }
    function moveTrack(e) {
      if (!tracking || e.pointerId !== tracking.id) return;
      tracking.lastX = e.clientX;
      tracking.lastY = e.clientY;
    }
    function endTrack(e) {
      if (!tracking || e.pointerId !== tracking.id) return;
      const dt = Math.max(1, now() - tracking.startT);
      const dx = tracking.lastX - tracking.startX;
      const dy = tracking.lastY - tracking.startY;
      const ax = Math.abs(dx), ay = Math.abs(dy);
      const vx = ax / dt;

      const isHorizontal = ax > ay * AXIS_LOCK_RATIO;
      const passed = ax > 35 || vx > MIN_VELOCITY;

      const link = e.target.closest && e.target.closest('a');
      tracking = null;

      if (link) return;
      if (isHorizontal && passed) {
        jumpBy(dx < 0 ? +1 : -1);
      }
    }

    function onClick(e) {
      const link = e.target.closest && e.target.closest('a');
      if (link) return;
      jumpBy(+1);
    }
    function onKey(e) {
      if (e.key === 'ArrowRight') jumpBy(+1);
      else if (e.key === 'ArrowLeft') jumpBy(-1);
    }

    // Block stray touchmove on old iOS (extra safety)
    document.addEventListener('touchmove', (e) => {
      const onLink = e.target.closest && e.target.closest('a');
      if (!onLink) e.preventDefault();
    }, { passive: false });

    /* ------------------ Kickoff ------------------ */
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      // Reduced motion: show first line and stop
      const buf = buffers[active];
      buf.innerHTML = renderItemToHTML(items[0]);
      buf.style.opacity = '1';
    } else {
      // Start the crossfading pulse from the beginning
      startLine(i);
    }

    // Input handlers
    document.addEventListener('pointerdown', beginTrack, { passive: true });
    document.addEventListener('pointermove',  moveTrack,  { passive: true });
    document.addEventListener('pointerup',    endTrack,   { passive: true });
    document.addEventListener('pointercancel', () => { tracking = null; }, { passive: true });
    document.addEventListener('click', onClick);
    document.addEventListener('keydown', onKey);

    // Favicon
    (function setFavicon() {
      const svg =
        `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64">
           <rect x="8" y="8" width="48" height="48" fill="#fff" stroke="#000" stroke-width="4" rx="6" ry="6"/>
         </svg>`;
      const href = "data:image/svg+xml," + encodeURIComponent(svg) + "#v=" + Date.now();
      document.querySelectorAll('link[rel="icon"]').forEach(n => n.remove());
      const link = document.createElement('link');
      link.rel = 'icon';
      link.type = 'image/svg+xml';
      link.href = href;
      document.head.appendChild(link);
    })();
  </script>
</body>
</html>
